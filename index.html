<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SAT Prep</title>
    <style>
        :root {
            --primary-color: #4a6ee0;
            --secondary-color: #f0f4f8;
            --text-color: #333;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--font-family);
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header {
            background-color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .logo { color: var(--primary-color); font-size: 1.5rem; font-weight: bold; }
        .user-info { display: flex; align-items: center; }
        .user-info img { width: 40px; height: 40px; border-radius: 50%; margin-left: 10px; }
        .user-info button {
            margin-left: 10px;
            padding: 5px 10px;
            font-size: 0.9rem;
            border: none;
            border-radius: 5px;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
        }
        h1 { font-size: 2rem; color: var(--primary-color); margin-bottom: 1rem; }
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .tab-container {
            display: flex;
            background-color: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
        }
        .tab { padding: 0.5rem 1rem; cursor: pointer; }
        .tab.active { background-color: var(--primary-color); color: white; }
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 10px 0;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 20px;
            transition: background-color 0.3s ease;
            width: 100%;
        }
        button:hover { background-color: #3558b2; }
        .practice-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .practice-item .icon {
            font-size: 2rem;
            margin-right: 1rem;
            width: 50px;
            height: 50px;
            min-width: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--secondary-color);
            border-radius: 25px;
        }
        #practiceView { display: none; }
        #questionLabel {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        #optionButtons button {
            background-color: white;
            color: var(--text-color);
            border: 1px solid #e0e0e0;
            margin: 0.5rem 0;
            text-align: left;
            width: 100%;
            transition: background-color 0.3s ease;
        }
        #optionButtons button:hover { background-color: var(--secondary-color); }
        #feedbackLabel {
            margin-top: 1rem;
            font-weight: bold;
            text-align: center;
        }
        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .progress-bar {
            flex-grow: 1;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin: 0 1rem;
            overflow: hidden;
            min-width: 100px;
        }
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        .passage-container {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .question-number {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        /* Updated Calculator styles */
        #dosCalculator {
            position: fixed;
            top: 50px;
            right: 20px;
            background-color: #f8f9fa;
            color: #333;
            padding: 20px;
            border: 2px solid #4a6ee0;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        #calculatorDisplay {
            background-color: #222;
            padding: 15px;
            margin-bottom: 20px;
            text-align: right;
            color: #0f0;
            font-size: 1.5rem;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            height: 50px;
            display: flex;
            align-items: center;
        }
        #dosCalculator button {
            width: 60px;
            height: 60px;
            margin: 5px;
            background-color: #4a6ee0;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #dosCalculator button:hover {
            background-color: #3558b2;
            transform: scale(1.05);
        }
        #dosCalculator button:active {
            transform: scale(0.95);
        }
        /* Settings Menu Modal styles */
        #settingsMenu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        #settingsContent {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        #settingsContent h2 {
            margin-bottom: 1rem;
        }
        #settingsContent button {
            margin: 5px 0;
            width: 100%;
        }
        #settingsOutput {
            margin-top: 10px;
            background: #f0f4f8;
            padding: 10px;
            border-radius: 4px;
            min-height: 50px;
            white-space: pre-wrap;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header class="container">
        <div class="logo">SAT Prep</div>
        <div class="user-info">
            Some Human
            <img src="https://via.placeholder.com/40" alt="User Avatar">
            <button id="openSettings">Settings</button>
        </div>
    </header>

    <main class="container">
        <section id="mainMenu">
            <h1>Welcome! Good luck on test day!</h1>

            <div class="card">
                <div class="section-header">
                    <h2>Your Tests</h2>
                    <div class="tab-container">
                        <div class="tab active">Active</div>
                        <div class="tab">Past</div>
                    </div>
                </div>
                <p>You may have an upcoming test.</p>
            </div>

            <div class="card">
                <div class="section-header">
                    <h2>Practice and Prepare</h2>
                    <div class="tab-container">
                        <div class="tab active">Active</div>
                        <div class="tab">Past</div>
                    </div>
                </div>
                <div class="practice-item">
                    <span class="icon">üìê</span>
                    <button class="start-practice" data-type="Math">Math Practice</button>
                </div>
                <div class="practice-item">
                    <span class="icon">üìö</span>
                    <button class="start-practice" data-type="Verbal">Verbal Practice</button>
                </div>
                <div class="practice-item">
                    <span class="icon">‚úçÔ∏è</span>
                    <button class="start-practice" data-type="Writing">Writing Practice</button>
                </div>
            </div>
        </section>

        <section id="practiceView" class="card">
            <button id="backButton">Back to Menu</button>
            <h2 id="practiceTitle"></h2>
            <div class="progress-container">
                <span id="questionNumber"></span>
                <div class="progress-bar">
                    <div id="progressBar" class="progress"></div>
                </div>
                <span id="timeRemaining">10:00</span>
            </div>
            <p id="questionLabel"></p>
            <div id="optionButtons"></div>
            <p id="feedbackLabel"></p>
            <button id="nextButton">Next Question</button>
            <button id="toggleCalculator">Toggle Calculator</button>
        </section>
    </main>

    <!-- Calculator -->
    <div id="dosCalculator">
        <div id="calculatorDisplay">0</div>
        <div>
            <button data-action="clear">C</button>
            <button data-digit="7">7</button>
            <button data-digit="8">8</button>
            <button data-digit="9">9</button>
            <button data-operator="/">/</button>
        </div>
        <div>
            <button data-digit="4">4</button>
            <button data-digit="5">5</button>
            <button data-digit="6">6</button>
            <button data-operator="*">X</button>
        </div>
        <div>
            <button data-digit="1">1</button>
            <button data-digit="2">2</button>
            <button data-digit="3">3</button>
            <button data-operator="-">-</button>
        </div>
        <div>
            <button data-digit="0">0</button>
            <button data-action="decimal">.</button>
            <button data-operator="=">=</button>
            <button data-operator="+">+</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsMenu">
        <div id="settingsContent">
            <h2>Settings</h2>
            <button id="btnViewSession">View Saved Practice Session</button>
            <button id="btnClearSession">Clear Saved Practice Session</button>
            <button id="btnViewTests">View Completed Tests</button>
            <button id="btnClearTests">Clear Completed Tests</button>
            <button id="btnCloseSettings">Close</button>
            <div id="settingsOutput"></div>
        </div>
    </div>

    <!-- Include the question files -->
    <script src="math-questions.js"></script>
    <script src="verbal-questions.js"></script>
    <script src="writing-questions.js"></script>

    <!-- Storage Functions (integrated from storage.js) -->
    <script>
        const STORAGE_KEY = 'SAT_PRACTICE_DATA';
        const COMPLETED_TESTS_KEY = 'COMPLETED_TESTS';

        // Save current practice session
        function savePracticeSession(practiceData) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(practiceData));
        }

        // Load saved practice session
        function loadPracticeSession() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            return savedData ? JSON.parse(savedData) : null;
        }

        // Clear saved practice session
        function clearPracticeSession() {
            localStorage.removeItem(STORAGE_KEY);
        }

        // Save completed test
        function saveCompletedTest(testData) {
            let completedTests = JSON.parse(localStorage.getItem(COMPLETED_TESTS_KEY) || '[]');
            completedTests.push(testData);
            localStorage.setItem(COMPLETED_TESTS_KEY, JSON.stringify(completedTests));
        }

        // Get all completed tests
        function getCompletedTests() {
            return JSON.parse(localStorage.getItem(COMPLETED_TESTS_KEY) || '[]');
        }

        // Make these functions available globally
        window.satPracticeStorage = {
            savePracticeSession,
            loadPracticeSession,
            clearPracticeSession,
            saveCompletedTest,
            getCompletedTests
        };
    </script>

    <!-- Main SAT Prep Script -->
    <script>
        (() => {
            // Cache DOM elements
            const mainMenu = document.getElementById('mainMenu');
            const practiceView = document.getElementById('practiceView');
            const practiceTitle = document.getElementById('practiceTitle');
            const questionLabel = document.getElementById('questionLabel');
            const optionButtons = document.getElementById('optionButtons');
            const feedbackLabel = document.getElementById('feedbackLabel');
            const nextButton = document.getElementById('nextButton');
            const progressBar = document.getElementById('progressBar');
            const timeDisplay = document.getElementById('timeRemaining');
            const toggleCalculatorBtn = document.getElementById('toggleCalculator');
            const backButton = document.getElementById('backButton');

            let currentPractice, currentQuestions, timerInterval;
            let currentQuestionIndex = 0, correctAnswers = 0, timeRemaining = 600;
            const totalQuestions = 5;

            // Event listeners
            document.querySelectorAll('.start-practice').forEach(btn => {
                btn.addEventListener('click', () => startPractice(btn.dataset.type));
            });
            backButton.addEventListener('click', showMainMenu);
            nextButton.addEventListener('click', showQuestion);
            toggleCalculatorBtn.addEventListener('click', toggleCalculator);

            function startPractice(type) {
                currentPractice = type;
                mainMenu.style.display = 'none';
                practiceView.style.display = 'block';
                practiceTitle.textContent = `${type} Practice`;
                currentQuestions = shuffleArray(getQuestionsByType(type)).slice(0, totalQuestions);
                currentQuestionIndex = correctAnswers = 0;
                timeRemaining = 600;
                updateProgressBar();
                startTimer();
                showQuestion();
                toggleCalculatorBtn.style.display = type === 'Math' ? 'block' : 'none';
            }

            function getQuestionsByType(type) {
                return {
                    Math: mathQuestions,
                    Verbal: verbalQuestions,
                    Writing: writingQuestions
                }[type] || [];
            }

            function shuffleArray(array) {
                return array.sort(() => Math.random() - 0.5);
            }

            function showQuestion() {
                if (currentQuestionIndex >= totalQuestions) return finishPractice();
                const question = currentQuestions[currentQuestionIndex];
                questionLabel.textContent = question.text;
                optionButtons.innerHTML = '';
                feedbackLabel.textContent = '';
                nextButton.style.display = 'none';

                document.querySelectorAll('.passage-container, .question-number').forEach(el => el.remove());

                if (question.hasPassage) {
                    const passageEl = document.createElement('div');
                    passageEl.className = 'passage-container';
                    passageEl.textContent = question.passage;
                    practiceView.insertBefore(passageEl, questionLabel);
                }

                const questionNumberEl = document.createElement('div');
                questionNumberEl.className = 'question-number';
                questionNumberEl.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestions}`;
                practiceView.insertBefore(questionNumberEl, questionLabel);

                question.options.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.textContent = `${String.fromCharCode(65 + idx)}. ${opt}`;
                    btn.addEventListener('click', () => checkAnswer(opt));
                    optionButtons.appendChild(btn);
                });
                updateProgressBar();
            }

            function checkAnswer(answer) {
                const question = currentQuestions[currentQuestionIndex];
                const isCorrect = answer === question.correctAnswer;
                feedbackLabel.textContent = isCorrect ? "Correct!" : `Incorrect. The correct answer is: ${question.correctAnswer}`;
                feedbackLabel.style.color = isCorrect ? '#4CAF50' : '#F44336';
                if (isCorrect) correctAnswers++;
                currentQuestionIndex++;
                nextButton.style.display = 'block';
                optionButtons.querySelectorAll('button').forEach(btn => btn.disabled = true);
                updateProgressBar();
            }

            function updateProgressBar() {
                progressBar.style.width = `${(currentQuestionIndex / totalQuestions) * 100}%`;
            }

            function startTimer() {
                clearInterval(timerInterval);
                updateTimerDisplay();
                timerInterval = setInterval(() => {
                    if (timeRemaining > 0) {
                        timeRemaining--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        finishPractice();
                    }
                }, 1000);
            }

            function updateTimerDisplay() {
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            function finishPractice() {
                clearInterval(timerInterval);
                alert(`Practice complete! Your score: ${((correctAnswers / totalQuestions) * 100).toFixed(1)}%`);
                showMainMenu();
            }

            function showMainMenu() {
                mainMenu.style.display = 'block';
                practiceView.style.display = 'none';
                currentQuestionIndex = correctAnswers = 0;
                timeRemaining = 600;
                progressBar.style.width = '0%';
                feedbackLabel.textContent = '';
                timeDisplay.textContent = '10:00';
                questionLabel.textContent = '';
                optionButtons.innerHTML = '';
                nextButton.style.display = 'none';
                document.getElementById('dosCalculator').style.display = 'none';
            }

            // Calculator Code
            class DOSCalculator {
                constructor() {
                    this.display = '0';
                    this.currentValue = null;
                    this.operator = null;
                    this.waitingForSecondOperand = false;
                    this.init();
                }

                init() {
                    this.displayElement = document.getElementById('calculatorDisplay');
                    this.updateDisplay();
                    const keys = document.querySelectorAll('#dosCalculator button');
                    keys.forEach(key => key.addEventListener('click', event => this.handleButton(event.target)));
                }

                updateDisplay() {
                    this.displayElement.textContent = this.display;
                }

                handleButton(button) {
                    const { action, digit, operator } = button.dataset;

                    if (digit) {
                        this.inputDigit(digit);
                    } else if (operator) {
                        this.handleOperator(operator);
                    } else if (action === 'decimal') {
                        this.inputDecimal();
                    } else if (action === 'clear') {
                        this.clear();
                    }
                }

                inputDigit(digit) {
                    if (this.waitingForSecondOperand) {
                        this.display = digit;
                        this.waitingForSecondOperand = false;
                    } else {
                        this.display = this.display === '0' ? digit : this.display + digit;
                    }
                    this.updateDisplay();
                }

                inputDecimal() {
                    if (this.waitingForSecondOperand) {
                        this.display = '0.';
                        this.waitingForSecondOperand = false;
                    } else if (!this.display.includes('.')) {
                        this.display += '.';
                    }
                    this.updateDisplay();
                }

                clear() {
                    this.display = '0';
                    this.currentValue = null;
                    this.operator = null;
                    this.waitingForSecondOperand = false;
                    this.updateDisplay();
                }

                handleOperator(nextOperator) {
                    const inputValue = parseFloat(this.display);

                    if (this.operator && this.waitingForSecondOperand) {
                        this.operator = nextOperator;
                        return;
                    }

                    if (this.currentValue == null && !isNaN(inputValue)) {
                        this.currentValue = inputValue;
                    } else if (this.operator) {
                        const result = this.performCalculation(this.operator, this.currentValue, inputValue);
                        this.display = String(result);
                        this.currentValue = result;
                    }

                    this.waitingForSecondOperand = true;
                    this.operator = nextOperator;
                    this.updateDisplay();
                }

                performCalculation(operator, firstOperand, secondOperand) {
                    switch (operator) {
                        case '+': return firstOperand + secondOperand;
                        case '-': return firstOperand - secondOperand;
                        case '*': return firstOperand * secondOperand;
                        case '/': return firstOperand / secondOperand;
                        case '=': return secondOperand;
                    }
                    return secondOperand;
                }
            }

            const calculator = new DOSCalculator();

            function toggleCalculator() {
                const calculatorDiv = document.getElementById('dosCalculator');
                calculatorDiv.style.display = calculatorDiv.style.display === 'none' ? 'block' : 'none';
            }

            // Initialize the calculator when the page loads
            window.addEventListener('load', () => {
                // Calculator is already initialized in the DOSCalculator class constructor
            });
        })();
    </script>

    <!-- Settings Menu Script -->
    <script>
        document.getElementById('openSettings').addEventListener('click', function() {
            document.getElementById('settingsMenu').style.display = 'flex';
        });
        document.getElementById('btnCloseSettings').addEventListener('click', function() {
            document.getElementById('settingsMenu').style.display = 'none';
        });
        document.getElementById('btnViewSession').addEventListener('click', function() {
            const session = window.satPracticeStorage.loadPracticeSession();
            document.getElementById('settingsOutput').innerText = session ? JSON.stringify(session, null, 2) : 'No saved practice session found.';
        });
        document.getElementById('btnClearSession').addEventListener('click', function() {
            window.satPracticeStorage.clearPracticeSession();
            document.getElementById('settingsOutput').innerText = 'Practice session cleared.';
        });
        document.getElementById('btnViewTests').addEventListener('click', function() {
            const tests = window.satPracticeStorage.getCompletedTests();
            document.getElementById('settingsOutput').innerText = tests.length ? JSON.stringify(tests, null, 2) : 'No completed tests found.';
        });
        document.getElementById('btnClearTests').addEventListener('click', function() {
            localStorage.removeItem('COMPLETED_TESTS');
            document.getElementById('settingsOutput').innerText = 'Completed tests cleared.';
        });
    </script>
</body>
</html>
