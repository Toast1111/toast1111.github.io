<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAT Practice Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .header {
            background-color: #f0f0f0;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .timer {
            font-weight: bold;
        }
        .main-content {
            display: flex;
            flex: 1;
            overflow-y: auto;
        }
        .question-text {
            flex: 1;
            padding: 20px;
            border-right: 1px solid #ccc;
        }
        .answer-section {
            flex: 1;
            padding: 20px;
        }
        .answer-option {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
        .answer-option.selected {
            background-color: #e0e0e0;
        }
        .footer {
            background-color: #f0f0f0;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        .nav-button {
            padding: 10px 20px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .save-status {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <div id="section-title">SAT Practice Test</div>
        <div class="timer" id="timer">Time remaining: <span id="time-left">180:00</span></div>
    </div>
    <div class="main-content">
        <div class="question-text" id="question-text">
            <p>Loading question...</p>
        </div>
        <div class="answer-section">
            <h3>Question <span id="question-number"></span></h3>
            <div class="answer-option" id="option-a">A. </div>
            <div class="answer-option" id="option-b">B. </div>
            <div class="answer-option" id="option-c">C. </div>
            <div class="answer-option" id="option-d">D. </div>
        </div>
    </div>
    <div class="footer">
        <div>
            <div id="student-name">Student Name</div>
            <div class="save-status" id="save-status"></div>
        </div>
        <div>
            <button class="nav-button" id="back-button">Back</button>
            <button class="nav-button" id="next-button">Next</button>
            <button class="nav-button" id="clear-progress-button">Clear Progress</button>
        </div>
    </div>

    <script>
        console.log("Script started");

        class Question {
            constructor(text, options, correctAnswer, category) {
                this.text = text;
                this.options = options;
                this.correctAnswer = correctAnswer;
                this.category = category;
            }
        }

        class SATPractice {
            constructor() {
                console.log("Initializing SATPractice");
                this.questions = [
                    new Question("What is 2 + 2?", ["3", "4", "5", "6"], "4", "Math"),
                    new Question("What is 2 + 4?", ["3", "6", "5", "4"], "6", "Math"),
                    new Question("What is 2 + 6?", ["3", "8", "5", "6"], "8", "Math"),
                    new Question("What is the opposite of 'benevolent'?", ["Malevolent", "Generous", "Kind", "Giving"], "Malevolent", "Verbal"),
                    new Question("Which sentence is grammatically correct?", 
                                ["Its a beautiful day.", "It's a beautiful day.", "Its' a beautiful day.", "It s' a beautiful day."],
                                "It's a beautiful day.", "Writing")
                ];
                console.log(`Initialized with ${this.questions.length} questions`);
            }

            getQuestion(index) {
                console.log(`Getting question at index ${index}`);
                if (index >= 0 && index < this.questions.length) {
                    return this.questions[index];
                }
                console.log("Question index out of bounds");
                return null;
            }

            checkAnswer(question, userAnswer) {
                if (question.correctAnswer === userAnswer) {
                    return [true, "Correct!"];
                } else {
                    return [false, `Incorrect. The correct answer is: ${question.correctAnswer}`];
                }
            }

            addQuestion(text, options, correctAnswer, category) {
                const newQuestion = new Question(text, options, correctAnswer, category);
                this.questions.push(newQuestion);
            }
        }

        const practice = new SATPractice();
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let timeLeft = 180 * 60; // 180 minutes in seconds

        function loadQuestion() {
            console.log(`Loading question at index ${currentQuestionIndex}`);
            const currentQuestion = practice.getQuestion(currentQuestionIndex);
            if (currentQuestion) {
                document.getElementById('question-number').textContent = currentQuestionIndex + 1;
                document.getElementById('question-text').innerHTML = `<p>${currentQuestion.text}</p>`;
                
                currentQuestion.options.forEach((option, index) => {
                    const element = document.getElementById(`option-${String.fromCharCode(97 + index)}`);
                    element.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                    element.classList.remove('selected');
                });

                if (userAnswers[currentQuestionIndex]) {
                    document.getElementById(`option-${userAnswers[currentQuestionIndex]}`).classList.add('selected');
                }
            } else {
                document.getElementById('question-text').innerHTML = '<p>No more questions available.</p>';
            }
        }

        function updateTimer() {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            document.getElementById('time-left').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            const timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimer();
                    if (timeLeft % 60 === 0) { // Save progress every minute
                        saveProgress();
                    }
                } else {
                    clearInterval(timerInterval);
                    alert('Time's up! The test has ended.');
                    submitTest();
                }
            }, 1000);
        }

        function saveProgress() {
            const progress = {
                currentQuestionIndex: currentQuestionIndex,
                userAnswers: userAnswers,
                timeLeft: timeLeft
            };
            localStorage.setItem('sat_practice_progress', JSON.stringify(progress));
            document.getElementById('save-status').textContent = 'Progress saved';
            setTimeout(() => {
                document.getElementById('save-status').textContent = '';
            }, 2000);
        }

        function loadProgress() {
            const savedProgress = localStorage.getItem('sat_practice_progress');
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                currentQuestionIndex = progress.currentQuestionIndex;
                userAnswers = progress.userAnswers;
                timeLeft = progress.timeLeft;
                console.log('Progress loaded');
            }
        }

        function clearProgress() {
            if (confirm('Are you sure you want to clear all progress? This action cannot be undone.')) {
                localStorage.removeItem('sat_practice_progress');
                currentQuestionIndex = 0;
                userAnswers = {};
                timeLeft = 180 * 60;
                loadQuestion();
                updateTimer();
                console.log('Progress cleared');
            }
        }

        function submitTest() {
            let score = 0;
            practice.questions.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    score++;
                }
            });
            alert(`Test submitted! Your score: ${score} out of ${practice.questions.length}`);
            console.log('Test submitted', { score, answers: userAnswers });
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM fully loaded");
            try {
                loadProgress();
                loadQuestion();
                startTimer();

                document.querySelectorAll('.answer-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const selectedOption = this.id.split('-')[1];
                        userAnswers[currentQuestionIndex] = selectedOption;
                        document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        saveProgress();
                    });
                });

                document.getElementById('next-button').addEventListener('click', function() {
                    currentQuestionIndex++;
                    if (currentQuestionIndex >= practice.questions.length) {
                        if (confirm('You've reached the end of the test. Are you ready to submit?')) {
                            submitTest();
                        } else {
                            currentQuestionIndex = practice.questions.length - 1;
                        }
                    }
                    loadQuestion();
                    saveProgress();
                });

                document.getElementById('back-button').addEventListener('click', function() {
                    if (currentQuestionIndex > 0) {
                        currentQuestionIndex--;
                        loadQuestion();
                        saveProgress();
                    }
                });

                document.getElementById('clear-progress-button').addEventListener('click', clearProgress);

                console.log("All event listeners set up");
            } catch (error) {
                console.error("Error during initialization:", error);
                document.getElementById('question-text').innerHTML = '<p>An error occurred while loading the test. Please refresh the page and try again.</p>';
            }
        });

        console.log("Script completed");
    </script>
</body>
</html>
